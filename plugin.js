function N(e){penpot.ui.sendMessage({pluginMessage:e})}function w(e){if("type"in e)return e}function U(e){switch(e.type){case"board":case"group":return e}}function G(e){switch(e.type){case"board":case"group":return e}}function q(e){return e.type==="board"&&(!e.parent||e.parent.id===e.id)}function A(){return{type:"icon-sets",state:{}}}function Q(e){return{type:"icon-set",prefix:e,state:{},parent:A()}}const Z=new Set(["animate","animateTransform","animateMotion"]),_=new Set(["set","discard"]);[...Z,..._];function H(e){function n(){if(e.getSharedPluginData("iconify","source")==="iconify"){const i=JSON.parse(e.getSharedPluginData("iconify","props")),s=i.name.split(":");if(s.length===2)switch(i.version){case 1:{const o=i.route||Q(s[0]);return Object.assign(i,{route:o})}}}}try{return n()}catch{}}function ee(e){return{nodes:e.nodes||Object.create(null),page:e.page||null,ignoreIconNode:e.ignoreIconNode||!1,iconNodeID:e.iconNodeID||null,iconNodeData:e.iconNodeData||null}}function te(e,n,t,i){function r(o){const a="page",c=t.nodes[a]??t.page;if(c)return o&&c.children.push(o),t.page=t.nodes[a]=c,c;const u={type:"page",id:a,name:e.name,target:"valid",children:o?[o]:[],primary:i,relative:!0};return t.nodes[u.id]=u,t.page=u,u}function s(o,a,c){if(q(o))return r(c);const u=o.id,l=t.nodes[u];if(l)return c&&l.children.push(c),l;let h="invalid",k=!1,y,p;const d=G(o);d&&(y=H(d),y&&(p=d.height,t.iconNodeID?t.ignoreIconNode=!0:(t.iconNodeID=u,t.iconNodeData=y)));const f=U(o);if(f){const P=w(f);P?(P.blocked||(h="valid"),(!a||P.blocked)&&(t.ignoreIconNode=!0),k=P.type!=="board"):h="valid"}else t.ignoreIconNode=!0;const m={type:o.type,id:u,name:o.name,target:h,children:c?[c]:[],primary:a,relative:k,icon:y,height:p};t.nodes[u]=m;const T=o.parent;return T?s(T,a,o.id):r(o.id),m}return s(n,i)}const ne=16;function M(){const e=penpot.currentPage;return{defaultNode:"page",nodes:[{type:"page",id:"page",name:(e==null?void 0:e.name)??"Page"}]}}function K(){const e=penpot.currentPage,n=penpot.selection;if(!e||!n.length)return M();const t=ee({});n.forEach((p,d)=>{te(e,p,t,!d)});const{nodes:i,page:r,iconNodeData:s,iconNodeID:o,ignoreIconNode:a}=t;if(!r)return M();const c=[];let u=r.type,l;function h(p,d=0){switch(p.target){case"ignored":{p.children.forEach(f=>{h(i[f],d)});break}case"valid":switch(p.type){case"page":{const f={type:"page",id:"page",name:p.name};c.push(f),p.children.forEach(m=>{h(i[m],d+1)});break}case"board":case"group":{const f={id:p.id,name:p.name,depth:d,type:p.type};!a&&s&&o===p.id&&(f.icon=s,f.height=p.height,l=f),p.icon||(c.push(f),p.primary&&!p.icon&&(u=p.id),p.children.forEach(m=>{h(i[m],d+1)}))}}}}h(r);let k=!1,y=ne;for(;c.length>y;)c.pop()===l&&(k=!0,y--);return k&&l&&c.push(l),{nodes:c,defaultNode:u,iconNode:l}}let $=K();function F(){return $}function oe(e){$=e}let x=!1;function ie(){const e=K();JSON.stringify(e)!==JSON.stringify(F())&&(oe(e),N({type:"plugin:nodes",nodes:e}))}function v(){x||(x=!0,setTimeout(()=>{x=!1,ie()},250))}function I(e,n,t=void 0){var i;try{const r=(i=penpot.currentFile)==null?void 0:i.getPluginData(e);if(typeof r=="string")return n?r:JSON.parse(r)}catch{}return t}function b(e,n){var t;(t=penpot.currentFile)==null||t.setPluginData(e,typeof n=="string"?n:JSON.stringify(n))}const W="recent";let g=[];const re=128;function ce(){const e=I(W);return e&&(g=e),e}let D=!1;function j(){D||(D=!0,setTimeout(()=>{D=!1,b(W,g),N({type:"plugin:recent-icons",icons:g})},1e3))}function z(e){for(const n of e){const t=g.indexOf(n);t!==-1&&g.splice(t,1),g.unshift(n),g.length>re&&g.pop(),j()}}function se(){g=[],j()}function V(e,n,t,i){e.name=n,e.setSharedPluginData("iconify","source","iconify");const r={version:1,name:n,props:t,route:i};e.setSharedPluginData("iconify","props",JSON.stringify(r))}function E(e,n){const t=n/e.height,i=e.width/e.height;e.resize(n*i,n);function r(s){switch(s.type){case"group":case"board":s.children.forEach(r);break;default:try{const o=[...s.strokes];let a=!1;o.forEach((c,u)=>{const l=c.strokeWidth;l&&(o[u]={...c,strokeWidth:l*t},a=!0)}),a&&(s.strokes=o)}catch(o){console.log(o)}}}r(e)}function B(e,n){const t=penpot.createShapeFromSvg(e);if(!t)return null;let i=n.replace;if(i){const s=i.parent;if(!s)return t.remove(),null;const o=s.children.findIndex(u=>u.id===i.id),a=i.parentX,c=i.parentY;return t.height!==i.height&&E(t,i.height),s.insertChild(o<0?0:o,t),t.parentX=a,t.parentY=c,t.proportionLock=!0,i.remove(),t}const r=i||t;return n.parent&&n.parent.appendChild(r),r.proportionLock=!0,n.height&&r.height!==n.height&&E(r,n.height),n.x&&(r.parentX=n.x),n.y&&(r.parentY=n.y),r}function O(e,n,t,i){const r=w(e);if(!r)return n;let s=0,o=i?r.width:r.height;if(n<s)return s;const a=s+o-t;return n>a?Math.max(s,a):n}function L(e,n,t){const i=n.icons.reduce((o,a)=>o+Math.ceil(a.width),0);let r=O(e,Math.round(t.targetX-i/2),i,!0);const s=[];for(const o of n.icons){const a=O(e,Math.round(t.targetY-o.height/2),o.height,!1),c=B(o.content,{parent:w(e),x:r,y:a,height:o.height});c&&(V(c,o.name,n.props,n.route),r+=Math.ceil(o.width),s.push(c))}return z(n.icons.map(o=>o.name)),N({type:"plugin:notice",color:"success",text:`Imported ${n.icons.length>1?n.icons.length+" icons":n.icons[0].name}`}),penpot.selection=s,v(),s}function S(){N({type:"plugin:notice",color:"error",text:"Error importing icon(s) to Penpot"})}function ae(e,n){const t=penpot.currentPage,i=t==null?void 0:t.getShapeById(e);if(!t||!i){S();return}const r=i.name;for(const s of n.icons){const o=s.name,a=B(s.content,{replace:i,x:i.parentX,y:i.parentY});if(!a){S();return}V(a,o,n.props,n.route),z([o]),N({type:"plugin:notice",color:"success",text:`Replaced ${r} with ${o}`}),penpot.selection=[a],v();return}S()}function ue(e,n){const t=penpot.currentPage;if(!t){S();return}const i=e==="page"?t:t.getShapeById(e);if(!i){S();return}const r=w(i);let s,o;if(r)s=r.width/2,o=r.height/2;else{const a=penpot.viewport.center;s=a.x,o=a.y}L(i,n,{targetX:s,targetY:o})}function pe(e){const n=penpot.currentPage;if(!n){S();return}const t=e.drop.x,i=e.drop.y,r=penpot.viewport,s=r.center.x,o=r.center.y,a=r.zoom,c=Math.round(s+t/a),u=Math.round(o+i/a);L(n,e.data,{targetX:c,targetY:u})}const X="icon-sets",Y="route-v31",R="recent-colors",C="customisations",J="pinned-filters";function le(){console.log("Starting plugin..."),penpot.on("themechange",a=>{N({type:"plugin:theme",theme:a})});const e=I(X,!1,void 0),n=(e==null?void 0:e.version)===1?e.data:void 0;let t=I(Y,!1);const i=ce(),r=I(R,!1),s=I(J,!1);let o=I(C,!1);penpot.on("selectionchange",v),penpot.on("pagechange",v),penpot.ui.onMessage(a=>{try{if(typeof(a==null?void 0:a.pluginMessage)!="object")return}catch(u){console.error(u)}const c=a.pluginMessage;switch(c.type){case"ui:fatal-error":{console.error("Fatal error:",c.error),penpot.closePlugin();break}case"ui:loaded":{N({type:"plugin:starting",nodes:F(),lists:n,pinned:s,recent:i,route:t,recentColors:r,custom:o});break}case"ui:lists":{const u={version:1,data:c.lists};b(X,u);break}case"ui:pinned-filters":{b(J,c.pinned);break}case"ui:route":{b(Y,c.route);break}case"ui:replace-icon":{ae(c.node,c.data);break}case"ui:import-icons":{ue(c.node,c.data);break}case"ui:drop-icon":{pe(c);break}case"ui:recent-colors":{b(R,c.colors);break}case"ui:customisations":{b(C,c.custom);break}case"ui:reset-recent-icons":{se();break}}}),penpot.ui.open("Iconify",`./index.html?theme=${penpot.theme}`,{width:570,height:640})}le();
