function N(e){penpot.ui.sendMessage({pluginMessage:e})}function w(e){if("type"in e)return e}function U(e){switch(e.type){case"board":case"group":return e}}function z(e){switch(e.type){case"board":case"group":return e}}function G(e){return e.type==="board"&&(!e.parent||e.parent.id===e.id)}function q(){return{type:"icon-sets",state:{}}}function A(e){return{type:"icon-set",prefix:e,state:{},parent:q()}}const Q=new Set(["animate","animateTransform","animateMotion"]),Z=new Set(["set","discard"]);[...Q,...Z];function _(e){function n(){if(e.getSharedPluginData("iconify","source")==="iconify"){const i=JSON.parse(e.getSharedPluginData("iconify","props")),s=i.name.split(":");if(s.length===2)switch(i.version){case 1:{const o=i.route||A(s[0]);return Object.assign(i,{route:o})}}}}try{return n()}catch{}}function H(e){return{nodes:e.nodes||Object.create(null),page:e.page||null,ignoreIconNode:e.ignoreIconNode||!1,iconNodeID:e.iconNodeID||null,iconNodeData:e.iconNodeData||null}}function ee(e,n,t,i){function c(o){const a="page",r=t.nodes[a]??t.page;if(r)return o&&r.children.push(o),t.page=t.nodes[a]=r,r;const l={type:"page",id:a,name:e.name,target:"valid",children:o?[o]:[],primary:i,relative:!0};return t.nodes[l.id]=l,t.page=l,l}function s(o,a,r){if(G(o))return c(r);const l=o.id,p=t.nodes[l];if(p)return r&&p.children.push(r),p;let h="invalid",b=!1,y,u;const d=z(o);d&&(y=_(d),y&&(u=d.height,t.iconNodeID?t.ignoreIconNode=!0:(t.iconNodeID=l,t.iconNodeData=y)));const f=U(o);if(f){const P=w(f);P?(P.blocked||(h="valid"),(!a||P.blocked)&&(t.ignoreIconNode=!0),b=P.type!=="board"):h="valid"}else t.ignoreIconNode=!0;const m={type:o.type,id:l,name:o.name,target:h,children:r?[r]:[],primary:a,relative:b,icon:y,height:u};t.nodes[l]=m;const T=o.parent;return T?s(T,a,o.id):c(o.id),m}return s(n,i)}const te=16;function M(){const e=penpot.currentPage;return{defaultNode:"page",nodes:[{type:"page",id:"page",name:(e==null?void 0:e.name)??"Page"}]}}function Y(){const e=penpot.currentPage,n=penpot.selection;if(!e||!n.length)return M();const t=H({});n.forEach((u,d)=>{ee(e,u,t,!d)});const{nodes:i,page:c,iconNodeData:s,iconNodeID:o,ignoreIconNode:a}=t;if(!c)return M();const r=[];let l=c.type,p;function h(u,d=0){switch(u.target){case"ignored":{u.children.forEach(f=>{h(i[f],d)});break}case"valid":switch(u.type){case"page":{const f={type:"page",id:"page",name:u.name};r.push(f),u.children.forEach(m=>{h(i[m],d+1)});break}case"board":case"group":{const f={id:u.id,name:u.name,depth:d,type:u.type};!a&&s&&o===u.id&&(f.icon=s,f.height=u.height,p=f),u.icon||(r.push(f),u.primary&&!u.icon&&(l=u.id),u.children.forEach(m=>{h(i[m],d+1)}))}}}}h(c);let b=!1,y=te;for(;r.length>y;)r.pop()===p&&(b=!0,y--);return b&&p&&r.push(p),{nodes:r,defaultNode:l,iconNode:p}}let $=Y();function W(){return $}function ne(e){$=e}let x=!1;function oe(){const e=Y();JSON.stringify(e)!==JSON.stringify(W())&&(ne(e),N({type:"plugin:nodes",nodes:e}))}function v(){x||(x=!0,setTimeout(()=>{x=!1,oe()},250))}function I(e,n,t=void 0){var i;try{const c=(i=penpot.currentFile)==null?void 0:i.getPluginData(e);if(typeof c=="string")return n?c:JSON.parse(c)}catch{}return t}function S(e,n){var t;(t=penpot.currentFile)==null||t.setPluginData(e,typeof n=="string"?n:JSON.stringify(n))}const F="recent";let g=[];const ie=128;function ce(){const e=I(F);return e&&(g=e),e}let D=!1;function j(){D||(D=!0,setTimeout(()=>{D=!1,S(F,g),N({type:"plugin:recent-icons",icons:g})},1e3))}function V(e){for(const n of e){const t=g.indexOf(n);t!==-1&&g.splice(t,1),g.unshift(n),g.length>ie&&g.pop(),j()}}function re(){g=[],j()}function B(e,n,t,i){e.name=n,e.setSharedPluginData("iconify","source","iconify");const c={version:1,name:n,props:t,route:i};e.setSharedPluginData("iconify","props",JSON.stringify(c))}function E(e,n){const t=n/e.height,i=e.width/e.height;e.resize(n*i,n);function c(s){switch(s.type){case"group":case"board":s.children.forEach(c);break;default:try{const o=[...s.strokes];let a=!1;o.forEach((r,l)=>{const p=r.strokeWidth;p&&(o[l]={...r,strokeWidth:p*t},a=!0)}),a&&(s.strokes=o)}catch(o){console.log(o)}}}c(e)}function L(e,n){const t=penpot.createShapeFromSvg(e);if(!t)return null;let i=n.replace;if(i){const s=i.parent;if(!s)return t.remove(),null;const o=s.children.findIndex(l=>l.id===i.id),a=i.parentX,r=i.parentY;return t.height!==i.height&&E(t,i.height),s.insertChild(o<0?0:o,t),t.parentX=a,t.parentY=r,t.proportionLock=!0,i.remove(),t}const c=i||t;return n.parent&&n.parent.appendChild(c),c.proportionLock=!0,n.height&&c.height!==n.height&&E(c,n.height),n.x&&(c.parentX=n.x),n.y&&(c.parentY=n.y),c}function O(e,n,t,i){const c=w(e);if(!c)return n;let s=0,o=i?c.width:c.height;if(n<s)return s;const a=s+o-t;return n>a?Math.max(s,a):n}function se(e,n,t){const i=n.icons.reduce((o,a)=>o+Math.ceil(a.width),0);let c=O(e,Math.round(t.targetX-i/2),i,!0);const s=[];for(const o of n.icons){const a=O(e,Math.round(t.targetY-o.height/2),o.height,!1),r=L(o.content,{parent:w(e),x:c,y:a,height:o.height});r&&(B(r,o.name,n.props,n.route),c+=Math.ceil(o.width),s.push(r))}return V(n.icons.map(o=>o.name)),N({type:"plugin:notice",color:"success",text:`Imported ${n.icons.length>1?n.icons.length+" icons":n.icons[0].name}`}),penpot.selection=s,v(),s}function k(){N({type:"plugin:notice",color:"error",text:"Error importing icon(s) to Penpot"})}function ae(e,n){const t=penpot.currentPage,i=t==null?void 0:t.getShapeById(e);if(!t||!i){k();return}const c=i.name;for(const s of n.icons){const o=s.name,a=L(s.content,{replace:i,x:i.parentX,y:i.parentY});if(!a){k();return}B(a,o,n.props,n.route),V([o]),N({type:"plugin:notice",color:"success",text:`Replaced ${c} with ${o}`}),penpot.selection=[a],v();return}k()}function ue(e,n){const t=penpot.currentPage;if(!t){k();return}const i=e==="page"?t:t.getShapeById(e);if(!i){k();return}const c=w(i);let s,o;if(c)s=c.width/2,o=c.height/2;else{const a=penpot.viewport.center;s=a.x,o=a.y}se(i,n,{targetX:s,targetY:o})}const R="icon-sets",C="route-v31",J="recent-colors",K="customisations",X="pinned-filters";function le(){console.log("Starting plugin..."),penpot.on("themechange",a=>{N({type:"plugin:theme",theme:a})});const e=I(R,!1,void 0),n=(e==null?void 0:e.version)===1?e.data:void 0;let t=I(C,!1);const i=ce(),c=I(J,!1),s=I(X,!1);let o=I(K,!1);penpot.on("selectionchange",v),penpot.on("pagechange",v),penpot.ui.onMessage(a=>{try{if(typeof(a==null?void 0:a.pluginMessage)!="object")return}catch(l){console.error(l)}const r=a.pluginMessage;switch(r.type){case"ui:loaded":{N({type:"plugin:starting",nodes:W(),lists:n,pinned:s,recent:i,route:t,recentColors:c,custom:o});break}case"ui:lists":{const l={version:1,data:r.lists};S(R,l);break}case"ui:pinned-filters":{S(X,r.pinned);break}case"ui:route":{S(C,r.route);break}case"ui:replace-icon":{ae(r.node,r.data);break}case"ui:import-icons":{ue(r.node,r.data);break}case"ui:recent-colors":{S(J,r.colors);break}case"ui:customisations":{S(K,r.custom);break}case"ui:reset-recent-icons":{re();break}}}),penpot.ui.open("Iconify",`./index.html?theme=${penpot.theme}`,{width:570,height:640})}le();
